<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Direct Deposit Analysis - MyBambu</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .date-selector {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .date-selector h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
        }

        .preset-btn {
            padding: 14px 20px;
            background: white;
            border: 2px solid #1e40af;
            border-radius: 8px;
            color: #1e40af;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            background: #1e40af;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .preset-btn.active {
            background: #1e40af;
            color: white;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .card .value {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .chart-section {
            margin-bottom: 40px;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-section h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .chart-container {
            position: relative;
            height: 400px;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        footer {
            text-align: center;
            padding: 30px 20px;
            background: #f8f9fa;
            color: #6c757d;
            font-size: 0.9em;
            line-height: 1.6;
        }

        footer p {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .preset-buttons {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Direct Deposit Analysis</h1>
            <p class="subtitle">ACH Transaction Insights & Trends</p>
        </header>

        <div class="content">
            <div class="date-selector">
                <h2>Select Date Range</h2>
                <div class="preset-buttons">
                    <button class="preset-btn active" onclick="setPreset('last_30')">Last 30 Days</button>
                    <button class="preset-btn" onclick="setPreset('last_60')">Last 60 Days</button>
                    <button class="preset-btn" onclick="setPreset('last_90')">Last 90 Days</button>
                    <button class="preset-btn" onclick="setPreset('august_2025')">August 2025</button>
                    <button class="preset-btn" onclick="setPreset('september_2025')">September 2025</button>
                    <button class="preset-btn" onclick="setPreset('october_2025')">October 2025</button>
                    <button class="preset-btn" onclick="setPreset('november_2025')">November 2025</button>
                </div>
            </div>

            <div class="summary-cards">
                <div class="card">
                    <h3>Unique Users</h3>
                    <div class="value" id="uniqueUsers">12,328</div>
                    <p>with Direct Deposits</p>
                </div>
                <div class="card">
                    <h3>Total Transactions</h3>
                    <div class="value" id="totalTransactions">37,385</div>
                    <p>ACH deposits received</p>
                </div>
                <div class="card">
                    <h3>Total Volume</h3>
                    <div class="value" id="totalVolume">$28.9M</div>
                    <p>in direct deposits</p>
                </div>
                <div class="card">
                    <h3>Average Deposit</h3>
                    <div class="value" id="avgDeposit">$774.27</div>
                    <p>per transaction</p>
                </div>
            </div>

            <div class="chart-section">
                <h2>Users with Direct Deposit by Company Type</h2>
                <div class="chart-container">
                    <canvas id="companyTypeChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2>Direct Deposit Amount Distribution</h2>
                <div class="chart-container">
                    <canvas id="bucketsChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2>Top 10 ACH Institutions by Frequency</h2>
                <div class="chart-container">
                    <canvas id="frequencyChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2>Top 10 ACH Institutions by Volume</h2>
                <div class="chart-container">
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Data Source:</strong> MYBAMBU_PROD.BAMBU_MART_GALILEO.MART_SRDF_POSTED_TRANSACTIONS</p>
            <p>Created by: Paid Ads Team</p>
        </footer>
    </div>

    <script>
        let bucketsChartInstance = null;
        let frequencyChartInstance = null;
        let volumeChartInstance = null;
        let companyTypeChartInstance = null;
        let currentPreset = 'last_30';

        // Company type categorization mapping
        const companyTypeMapping = {
            'Employers': [
                'DoorDash, Inc.', 'UBER USA 6787', 'Amazon Logistics', 'AMAZON.COM SVCS', 'WAL-MART ASSOCS.',
                'TYSON FOODS, INC', 'COMPASS GROUP', 'CHEDRAUI USA INC', 'FUYAO GLASS AMER', 'LAKESIDE FOODS',
                'UBER USA, LLC', 'RAISER 6795', 'JERDON ENTERPRIS', 'UFP INDUSTRIES I', 'VOSS USA LLC',
                'LIBERTY CASTING', 'BECHTEL GROUP IN', 'DPR Construction', 'BAKER CONCRETE C', 'ASPEN BUILDERS,',
                'MIDLAND CONSTRUC', 'ENVIRONMENTAL DE', 'FOX ENTERPRISES,', 'TRADITIONS MANAG', 'Oakridge Nursery',
                'SUNSHINE DAIRY L', 'TORGINOL INC', 'NEXTGEN HD DRILL', 'SPARTAN COMPANIE', 'KENTUCKY MIRROR',
                'CREATIVE LIQUID', 'LIQUID STRUCTURE', 'ADVANCED WALLS', 'ALFARO S INDUSTR', 'ASCHER BUILDING',
                'RSL CONTRACTORS,', 'EMPIRE AG LLC', 'EXPO SERVICES LL', 'Bloom Lawn and L', 'MCPLASTER POOLS',
                'FOREVER CLEAN PO', 'FLEET EQUIPMENT', 'MIESFELD S TRIAN', 'A R TRIM ENTERPR', 'ABG OPERATING LL',
                'FULL CIRCLE DAIR', 'DELOREAN QUALITY', 'Todd & Sargent,', 'PROFESSIONAL POW', 'GARDNER-WATSON D',
                'Gemini Express T', 'RPM INSTALLATION', 'CHEDRAUI USA INC', 'Ouris Mark 8638', 'LARRETT ENERGY S',
                'Savard Labor & M', '7shifts', 'Miter Payroll', 'TEAM MEMBERS'
            ],
            'Staffing Agencies': [
                'ATLANTA STAFFING', 'Drive Staff Inc', 'LEADERS STAFFING', '3 PROMISE LABOR', 'LUXOR STAFFING',
                'ARC TALENT SOLUT', 'PEOPLEASE', 'EMP SERV LLC', 'WWR PLACEMENT', 'SENTRY, LLC',
                'ESSG II (500)', 'Kamps, Inc.-OSV'
            ],
            'Payroll Companies / Fintech': [
                'DAILYPAY', 'STRIPE', 'Square Inc', 'GUSTO', 'GUSTO PAYROLL', 'ADP TOTALSOURCE',
                'PAYCHEX ADVANCE', 'MM HR PAYROLL', 'MINUTE MEN HR', 'ARA-1', 'BARRETT BUSINESS',
                'TRH WD PAYROLL Q', 'Coadvantage Reso', 'Partners 1784', 'Wisely ACH', 'Payroll4Const',
                'EPAY SYSTEMS', 'PR2416 2111 ENDE', 'CARD SERVICES'
            ],
            'Financial Institutions': [
                'WELLS FARGO IFI', 'JPMorgan Chase', 'BANK OF AMERICA', 'CAPITAL ONE', 'STERLING NAT BNK',
                'AXIOM BANK NA FB', 'FTSB'
            ],
            'Government / Treasury Payments': [
                'SSA  TREAS 310', 'SSI  TREAS 310', 'IRS  TREAS 310'
            ],
            'Money Transfer / Remittance Services': [
                'VIAMERICAS CORP'
            ]
        };

        function categorizeInstitution(name) {
            const cleanName = name.trim();
            for (const [category, institutions] of Object.entries(companyTypeMapping)) {
                if (institutions.some(inst => cleanName.includes(inst.trim()) || inst.trim().includes(cleanName))) {
                    return category;
                }
            }
            return 'Employers'; // Default fallback
        }

        function calculateCompanyTypeBreakdown(topByVolume) {
            const breakdown = {
                'Employers': 0,
                'Staffing Agencies': 0,
                'Payroll Companies / Fintech': 0,
                'Financial Institutions': 0,
                'Government / Treasury Payments': 0,
                'Money Transfer / Remittance Services': 0
            };

            topByVolume.forEach(inst => {
                const category = categorizeInstitution(inst.name);
                breakdown[category] += inst.volume;
            });

            return breakdown;
        }

        // Preset to date range mapping
        const presetDates = {
            'last_30': ['2025-10-11', '2025-11-09'],
            'last_60': ['2025-09-11', '2025-11-09'],
            'last_90': ['2025-08-12', '2025-11-09'],
            'august_2025': ['2025-08-01', '2025-08-31'],
            'september_2025': ['2025-09-01', '2025-09-30'],
            'october_2025': ['2025-10-01', '2025-10-31'],
            'november_2025': ['2025-11-01', '2025-11-10']
        };

        const dataCache = {"2025-10-11_2025-11-09":{"summary":{"uniqueUsers":12113,"totalTransactions":35548,"totalVolume":27772513.71,"avgDeposit":781.27},"buckets":[{"range":"$1-$250","count":6614},{"range":"$250-$500","count":4659},{"range":"$500-$750","count":8090},{"range":"$750-$1,000","count":6228},{"range":"$1,000-$1,500","count":6466},{"range":"$1,500-$2,500","count":3012},{"range":"$2,500+","count":479}],"topByFrequency":[{"name":"DoorDash, Inc.","count":670,"volume":145319.90},{"name":"Amazon Logistics","count":616,"volume":134420.31},{"name":"WELLS FARGO IFI","count":501,"volume":170016.24},{"name":"UBER USA 6787","count":403,"volume":142726.81},{"name":"DAILYPAY","count":361,"volume":129083.69},{"name":"JPMorgan Chase","count":328,"volume":81396.30},{"name":"VIAMERICAS CORP","count":157,"volume":47167.78},{"name":"CARD SERVICES","count":157,"volume":48643.91},{"name":"ARA-1","count":148,"volume":97317.34},{"name":"STRIPE","count":139,"volume":19661.83}],"topByVolume":[{"name":"WELLS FARGO IFI","count":501,"volume":170016.24},{"name":"DoorDash, Inc.","count":670,"volume":145319.90},{"name":"UBER USA 6787","count":403,"volume":142726.81},{"name":"Amazon Logistics","count":616,"volume":134420.31},{"name":"DAILYPAY","count":361,"volume":129083.69},{"name":"TEAM MEMBERS","count":104,"volume":111066.14},{"name":"ARA-1","count":148,"volume":97317.34},{"name":"SSA  TREAS 310","count":78,"volume":81602.00},{"name":"JPMorgan Chase","count":328,"volume":81396.30},{"name":"ATLANTA STAFFING","count":80,"volume":77553.34}]},"2025-09-11_2025-11-09":{"summary":{"uniqueUsers":14429,"totalTransactions":77173,"totalVolume":60433270.61,"avgDeposit":783.09},"buckets":[{"range":"$1-$250","count":14030},{"range":"$250-$500","count":10077},{"range":"$500-$750","count":17630},{"range":"$750-$1,000","count":13805},{"range":"$1,000-$1,500","count":14209},{"range":"$1,500-$2,500","count":6403},{"range":"$2,500+","count":1019}],"topByFrequency":[{"name":"DoorDash, Inc.","count":1328,"volume":278278.70},{"name":"Amazon Logistics","count":1208,"volume":258132.50},{"name":"WELLS FARGO IFI","count":1133,"volume":393029.08},{"name":"JPMorgan Chase","count":778,"volume":189613.07},{"name":"DAILYPAY","count":765,"volume":281921.97},{"name":"UBER USA 6787","count":700,"volume":234223.31},{"name":"CARD SERVICES","count":372,"volume":120708.23},{"name":"ARA-1","count":336,"volume":220275.56},{"name":"VIAMERICAS CORP","count":324,"volume":87213.68},{"name":"STRIPE","count":320,"volume":41768.74}],"topByVolume":[{"name":"WELLS FARGO IFI","count":1133,"volume":393029.08},{"name":"DAILYPAY","count":765,"volume":281921.97},{"name":"DoorDash, Inc.","count":1328,"volume":278278.70},{"name":"Amazon Logistics","count":1208,"volume":258132.50},{"name":"UBER USA 6787","count":700,"volume":234223.31},{"name":"TEAM MEMBERS","count":212,"volume":227057.28},{"name":"ARA-1","count":336,"volume":220275.56},{"name":"MM HR PAYROLL","count":227,"volume":197865.88},{"name":"JPMorgan Chase","count":778,"volume":189613.07},{"name":"ADP TOTALSOURCE","count":161,"volume":179158.48}]},"2025-08-12_2025-11-09":{"summary":{"uniqueUsers":16650,"totalTransactions":113677,"totalVolume":88260404.46,"avgDeposit":776.41},"buckets":[{"range":"$1-$250","count":21189},{"range":"$250-$500","count":14893},{"range":"$500-$750","count":25672},{"range":"$750-$1,000","count":20451},{"range":"$1,000-$1,500","count":20711},{"range":"$1,500-$2,500","count":9293},{"range":"$2,500+","count":1468}],"topByFrequency":[{"name":"DoorDash, Inc.","count":2216,"volume":464831.03},{"name":"WELLS FARGO IFI","count":1804,"volume":610026.38},{"name":"Amazon Logistics","count":1656,"volume":351000.19},{"name":"JPMorgan Chase","count":1302,"volume":329264.36},{"name":"UBER USA 6787","count":1258,"volume":385675.81},{"name":"DAILYPAY","count":1123,"volume":415871.92},{"name":"CARD SERVICES","count":572,"volume":187759.88},{"name":"STRIPE","count":511,"volume":67006.20},{"name":"VIAMERICAS CORP","count":485,"volume":125839.53},{"name":"ARA-1","count":478,"volume":309858.75}],"topByVolume":[{"name":"WELLS FARGO IFI","count":1804,"volume":610026.38},{"name":"DoorDash, Inc.","count":2216,"volume":464831.03},{"name":"DAILYPAY","count":1123,"volume":415871.92},{"name":"UBER USA 6787","count":1258,"volume":385675.81},{"name":"Amazon Logistics","count":1656,"volume":351000.19},{"name":"MM HR PAYROLL","count":400,"volume":344695.51},{"name":"TEAM MEMBERS","count":317,"volume":342216.83},{"name":"JPMorgan Chase","count":1302,"volume":329264.36},{"name":"ARA-1","count":478,"volume":309858.75},{"name":"ADP TOTALSOURCE","count":243,"volume":262725.52}]},"2025-11-01_2025-11-10":{"summary":{"uniqueUsers":8119,"totalTransactions":8958,"totalVolume":6998049.29,"avgDeposit":781.21},"buckets":[{"range":"$1-$250","count":1619},{"range":"$250-$500","count":1228},{"range":"$500-$750","count":2090},{"range":"$750-$1,000","count":1515},{"range":"$1,000-$1,500","count":1617},{"range":"$1,500-$2,500","count":774},{"range":"$2,500+","count":115}],"topByFrequency":[{"name":"Amazon Logistics","count":168,"volume":36230.65},{"name":"DoorDash, Inc.","count":154,"volume":34229.46},{"name":"WELLS FARGO IFI","count":129,"volume":40567.64},{"name":"UBER USA 6787","count":105,"volume":37447.89},{"name":"DAILYPAY","count":84,"volume":35741.65},{"name":"JPMorgan Chase","count":79,"volume":22523.06},{"name":"SSA  TREAS 310","count":60,"volume":64054.40},{"name":"MINUTE MEN HR","count":45,"volume":39144.17},{"name":"STRIPE","count":41,"volume":5373.03},{"name":"VIAMERICAS CORP","count":37,"volume":12761.78}],"topByVolume":[{"name":"SSA  TREAS 310","count":60,"volume":64054.40},{"name":"WELLS FARGO IFI","count":129,"volume":40567.64},{"name":"MINUTE MEN HR","count":45,"volume":39144.17},{"name":"UBER USA 6787","count":105,"volume":37447.89},{"name":"Amazon Logistics","count":168,"volume":36230.65},{"name":"DAILYPAY","count":84,"volume":35741.65},{"name":"DoorDash, Inc.","count":154,"volume":34229.46},{"name":"GUSTO PAYROLL","count":20,"volume":24902.03},{"name":"ARA-1","count":36,"volume":24260.33},{"name":"WAL-MART ASSOCS.","count":25,"volume":23851.78}]},"2025-08-01_2025-08-31":{"summary":{"uniqueUsers":12284,"totalTransactions":39954,"totalVolume":31414629.32,"avgDeposit":786.27},"buckets":[{"range":"$1-$250","count":7069},{"range":"$250-$500","count":5183},{"range":"$500-$750","count":9021},{"range":"$750-$1,000","count":7362},{"range":"$1,000-$1,500","count":7485},{"range":"$1,500-$2,500","count":3339},{"range":"$2,500+","count":495}],"topByFrequency":[{"name":"DoorDash, Inc.","count":702,"volume":150318.34},{"name":"WELLS FARGO IFI","count":652,"volume":214974.73},{"name":"JPMorgan Chase","count":477,"volume":120134.11},{"name":"Amazon Logistics","count":477,"volume":92647.27},{"name":"UBER USA 6787","count":458,"volume":122288.27},{"name":"DAILYPAY","count":377,"volume":140194.25},{"name":"CARD SERVICES","count":188,"volume":64967.72},{"name":"Square Inc","count":166,"volume":73308.33},{"name":"ARA-1","count":166,"volume":105931.96},{"name":"VIAMERICAS CORP","count":159,"volume":42402.63}],"topByVolume":[{"name":"WELLS FARGO IFI","count":652,"volume":214974.73},{"name":"DoorDash, Inc.","count":702,"volume":150318.34},{"name":"DAILYPAY","count":377,"volume":140194.25},{"name":"UBER USA 6787","count":458,"volume":122288.27},{"name":"JPMorgan Chase","count":477,"volume":120134.11},{"name":"SSI  TREAS 310","count":143,"volume":119930.31},{"name":"MM HR PAYROLL","count":137,"volume":114986.29},{"name":"GUSTO","count":134,"volume":112977.4},{"name":"TEAM MEMBERS","count":102,"volume":109555.21},{"name":"ARA-1","count":166,"volume":105931.96}]},"2025-09-01_2025-09-30":{"summary":{"uniqueUsers":12298,"totalTransactions":36188,"totalVolume":27504356.4,"avgDeposit":760.04},"buckets":[{"range":"$1-$250","count":7209},{"range":"$250-$500","count":4913},{"range":"$500-$750","count":7963},{"range":"$750-$1,000","count":6616},{"range":"$1,000-$1,500","count":6280},{"range":"$1,500-$2,500","count":2759},{"range":"$2,500+","count":448}],"topByFrequency":[{"name":"DoorDash, Inc.","count":844,"volume":172555.2},{"name":"WELLS FARGO IFI","count":636,"volume":217085.64},{"name":"Amazon Logistics","count":539,"volume":118306.36},{"name":"UBER USA 6787","count":514,"volume":154537.4},{"name":"JPMorgan Chase","count":464,"volume":117678.57},{"name":"DAILYPAY","count":355,"volume":136175.05},{"name":"CARD SERVICES","count":226,"volume":77607.43},{"name":"VIAMERICAS CORP","count":171,"volume":36990.08},{"name":"STRIPE","count":170,"volume":21583.93},{"name":"Square Inc","count":167,"volume":61780.3}],"topByVolume":[{"name":"WELLS FARGO IFI","count":636,"volume":217085.64},{"name":"DoorDash, Inc.","count":844,"volume":172555.2},{"name":"UBER USA 6787","count":514,"volume":154537.4},{"name":"DAILYPAY","count":355,"volume":136175.05},{"name":"MM HR PAYROLL","count":143,"volume":124926.06},{"name":"Amazon Logistics","count":539,"volume":118306.36},{"name":"JPMorgan Chase","count":464,"volume":117678.57},{"name":"TEAM MEMBERS","count":107,"volume":115653.12},{"name":"ADP TOTALSOURCE","count":76,"volume":100857.43},{"name":"ARA-1","count":154,"volume":96363.85}]},"2025-10-01_2025-10-31":{"summary":{"uniqueUsers":12511,"totalTransactions":42949,"totalVolume":33925519.14,"avgDeposit":789.9},"buckets":[{"range":"$1-$250","count":7795},{"range":"$250-$500","count":5610},{"range":"$500-$750","count":9604},{"range":"$750-$1,000","count":7909},{"range":"$1,000-$1,500","count":7853},{"range":"$1,500-$2,500","count":3597},{"range":"$2,500+","count":581}],"topByFrequency":[{"name":"DoorDash, Inc.","count":687,"volume":145676.88},{"name":"Amazon Logistics","count":665,"volume":141879.3},{"name":"WELLS FARGO IFI","count":596,"volume":206387.93},{"name":"DAILYPAY","count":436,"volume":148600.1},{"name":"JPMorgan Chase","count":415,"volume":103627.06},{"name":"UBER USA 6787","count":303,"volume":106591.18},{"name":"CARD SERVICES","count":194,"volume":56402.0},{"name":"STRIPE","count":194,"volume":26120.38},{"name":"ARA-1","count":186,"volume":123019.59},{"name":"VIAMERICAS CORP","count":174,"volume":49952.0}],"topByVolume":[{"name":"WELLS FARGO IFI","count":596,"volume":206387.93},{"name":"TEAM MEMBERS","count":156,"volume":168899.48},{"name":"DAILYPAY","count":436,"volume":148600.1},{"name":"DoorDash, Inc.","count":687,"volume":145676.88},{"name":"Amazon Logistics","count":665,"volume":141879.3},{"name":"SSI  TREAS 310","count":161,"volume":135144.4},{"name":"MM HR PAYROLL","count":152,"volume":132104.71},{"name":"ARA-1","count":186,"volume":123019.59},{"name":"UBER USA 6787","count":303,"volume":106591.18},{"name":"ATLANTA STAFFING","count":102,"volume":106466.3}]}};

        function setPreset(presetName) {
            currentPreset = presetName;
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateData();
        }

        function updateData() {
            const dates = presetDates[currentPreset];
            const cacheKey = `${dates[0]}_${dates[1]}`;
            let data = dataCache[cacheKey];

            if (!data) {
                const fallbackDates = presetDates.last_30;
                const fallbackKey = `${fallbackDates[0]}_${fallbackDates[1]}`;
                data = dataCache[fallbackKey];
                currentPreset = 'last_30';
                document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.preset-btn')[0].classList.add('active');
            }

            updateSummaryCards(data.summary);
            updateCharts(data);
        }

        function updateSummaryCards(summary) {
            document.getElementById('uniqueUsers').textContent = formatNumber(summary.uniqueUsers);
            document.getElementById('totalTransactions').textContent = formatNumber(summary.totalTransactions);
            document.getElementById('totalVolume').textContent = formatCurrency(summary.totalVolume);
            document.getElementById('avgDeposit').textContent = formatCurrency(summary.avgDeposit);
        }

        function updateCharts(data) {
            if (bucketsChartInstance) bucketsChartInstance.destroy();
            if (frequencyChartInstance) frequencyChartInstance.destroy();
            if (volumeChartInstance) volumeChartInstance.destroy();
            if (companyTypeChartInstance) companyTypeChartInstance.destroy();

            // Company Type Pie Chart
            const companyBreakdown = calculateCompanyTypeBreakdown(data.topByVolume);
            const companyTypeCtx = document.getElementById('companyTypeChart').getContext('2d');
            companyTypeChartInstance = new Chart(companyTypeCtx, {
                type: 'pie',
                data: {
                    labels: Object.keys(companyBreakdown),
                    datasets: [{
                        data: Object.values(companyBreakdown),
                        backgroundColor: [
                            '#22c55e',  // Employers - Green
                            '#fbbf24',  // Staffing Agencies - Yellow
                            '#f97316',  // Payroll/Fintech - Orange
                            '#3b82f6',  // Financial Institutions - Blue
                            '#a855f7',  // Government - Purple
                            '#ec4899'   // Money Transfer - Pink
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.parsed || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${label}: $${value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Buckets Chart
            const bucketsCtx = document.getElementById('bucketsChart').getContext('2d');
            bucketsChartInstance = new Chart(bucketsCtx, {
                type: 'bar',
                data: {
                    labels: data.buckets.map(b => b.range),
                    datasets: [{
                        label: 'Number of Transactions',
                        data: data.buckets.map(b => b.count),
                        backgroundColor: 'rgba(30, 64, 175, 0.8)',
                        borderColor: 'rgba(30, 64, 175, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Frequency Chart
            const frequencyCtx = document.getElementById('frequencyChart').getContext('2d');
            frequencyChartInstance = new Chart(frequencyCtx, {
                type: 'bar',
                data: {
                    labels: data.topByFrequency.map(i => i.name),
                    datasets: [{
                        label: 'Transaction Count',
                        data: data.topByFrequency.map(i => i.count),
                        backgroundColor: 'rgba(29, 78, 216, 0.8)',
                        borderColor: 'rgba(29, 78, 216, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Volume Chart
            const volumeCtx = document.getElementById('volumeChart').getContext('2d');
            volumeChartInstance = new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    labels: data.topByVolume.map(i => i.name),
                    datasets: [{
                        label: 'Transaction Volume ($)',
                        data: data.topByVolume.map(i => i.volume),
                        backgroundColor: 'rgba(30, 64, 175, 0.8)',
                        borderColor: 'rgba(30, 64, 175, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.x.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                                }
                            }
                        }
                    }
                }
            });
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        function formatCurrency(num) {
            if (num >= 1000000) {
                return '$' + (num / 1000000).toFixed(1) + 'M';
            }
            return '$' + num.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }

        window.onload = function() {
            updateData();
        };
    </script>
</body>
</html>