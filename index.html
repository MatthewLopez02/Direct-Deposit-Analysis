<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Direct Deposit Analysis - MyBambu</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .content {
            padding: 40px;
        }

        .date-selector {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .date-selector h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 12px;
        }

        .preset-btn {
            padding: 14px 20px;
            background: white;
            border: 2px solid #1e40af;
            border-radius: 8px;
            color: #1e40af;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .preset-btn:hover {
            background: #1e40af;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(30, 64, 175, 0.3);
        }

        .preset-btn.active {
            background: #1e40af;
            color: white;
        }

        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .card {
            background: linear-gradient(135deg, #1d4ed8 0%, #1e40af 100%);
            padding: 25px;
            border-radius: 12px;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .card .value {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .chart-section {
            margin-bottom: 40px;
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .chart-section h2 {
            color: #1e40af;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .chart-container {
            position: relative;
            height: 400px;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }

        .staffing-list {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-height: 400px;
            overflow-y: auto;
        }

        .staffing-list-item {
            display: flex;
            justify-content: space-between;
            padding: 12px;
            border-bottom: 1px solid #e5e7eb;
            align-items: center;
        }

        .staffing-list-item:last-child {
            border-bottom: none;
        }

        .staffing-list-item:hover {
            background: #f8f9fa;
        }

        .staffing-name {
            font-weight: 600;
            color: #1e40af;
        }

        .staffing-stats {
            display: flex;
            gap: 20px;
            font-size: 0.9em;
            color: #6c757d;
        }

        footer {
            text-align: center;
            padding: 30px 20px;
            background: #f8f9fa;
            color: #6c757d;
            font-size: 0.9em;
            line-height: 1.6;
        }

        footer p {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            h1 {
                font-size: 1.8em;
            }

            .content {
                padding: 20px;
            }

            .preset-buttons {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 300px;
            }

            .staffing-stats {
                flex-direction: column;
                gap: 4px;
            }
        }
    </style>
</head>
<body>
<!--
========================================
REPORT METHODOLOGY & DATA DOCUMENTATION
========================================

Report: Direct Deposit Analysis - MyBambu
Last Updated: November 12, 2025
Generated By: Claude Code

DATA SOURCES:
- Primary Table: MYBAMBU_PROD.BAMBU_MART_GALILEO.MART_SRDF_POSTED_TRANSACTIONS
- Key Field for Institution Name: ACH_INSTITUTION_NAME

FILTERS APPLIED:
- Transaction Code: TRANSACTION_CODE = 'PMOF' (ACH Direct Deposit transactions only)
- Date Filtering: Uses DATE(POST_DATE) to ensure all transactions throughout each day are included
- Positive Amounts: For bucket analysis, filters TRANSACTION_AMOUNT > 0

DATE RANGES (As of Nov 12, 2025):
- Last 30 Days: October 13, 2025 - November 11, 2025
- Last 60 Days: September 13, 2025 - November 11, 2025
- Last 90 Days: August 14, 2025 - November 11, 2025
- Last 90 Days (Staffing Agencies Only): August 14, 2025 - November 11, 2025 [NEW]
- November 2025: November 1, 2025 - November 11, 2025
- August 2025: August 1, 2025 - August 31, 2025 (Historical - not updated)
- September 2025: September 1, 2025 - September 30, 2025 (Historical - not updated)
- October 2025: October 1, 2025 - October 31, 2025 (Historical - not updated)

KEY CALCULATIONS:

1. Summary Metrics:
   - Unique Users: COUNT(DISTINCT PRN)
   - Total Transactions: COUNT(*)
   - Total Volume: SUM(TRANSACTION_AMOUNT)
   - Average Deposit: AVG(TRANSACTION_AMOUNT)

2. Amount Distribution Buckets:
   CASE
       WHEN TRANSACTION_AMOUNT BETWEEN 1 AND 250 THEN '$1-$250'
       WHEN TRANSACTION_AMOUNT BETWEEN 250.01 AND 500 THEN '$250-$500'
       WHEN TRANSACTION_AMOUNT BETWEEN 500.01 AND 750 THEN '$500-$750'
       WHEN TRANSACTION_AMOUNT BETWEEN 750.01 AND 1000 THEN '$750-$1,000'
       WHEN TRANSACTION_AMOUNT BETWEEN 1000.01 AND 1500 THEN '$1,000-$1,500'
       WHEN TRANSACTION_AMOUNT BETWEEN 1500.01 AND 2500 THEN '$1,500-$2,500'
       WHEN TRANSACTION_AMOUNT > 2500 THEN '$2,500+'
   END as range

3. Top Institutions by Frequency:
   - Groups by ACH_INSTITUTION_NAME
   - Orders by COUNT(*) DESC
   - Shows top 10 institutions (or top 20 for staffing agencies only view)

4. Top Institutions by Volume:
   - Groups by ACH_INSTITUTION_NAME
   - Orders by SUM(TRANSACTION_AMOUNT) DESC
   - Shows top 10 institutions (or top 20 for staffing agencies only view)

5. Company Type Categorization:
   - Institutions are mapped to categories:
     * Employers
     * Staffing Agencies
     * Payroll Companies / Fintech
     * Financial Institutions
     * Government / Treasury Payments
     * Money Transfer / Remittance Services
   - Mapping is defined in companyTypeMapping object in JavaScript
   - Pie chart shows volume distribution across categories (replaced with staffing agency list for staffing-only view)

6. Staffing Agency Identification Methodology (Nov 12, 2025):
   - Query Process:
     * Extracted all ACH institutions from last 90 days (Aug 14 - Nov 11, 2025)
     * Filtered to institutions with 10+ transactions
     * Limited to top 200 institutions by transaction count

   - Research Process:
     * Manually researched each institution name online
     * Verified business type through company websites, LinkedIn, industry databases
     * Categorized as staffing agency if primary business is workforce/staffing/recruitment

   - Staffing Agencies Identified (26 total):
     * Already in mapping (6 still active): ATLANTA STAFFING, Kamps Inc.-OSV, LUXOR STAFFING,
       Drive Staff Inc, PEOPLEASE, LEADERS STAFFING
     * New additions (20): Staffing Partner, Medix, TEAM EASYSTAFF, HIRE Dynamics, People 2.0,
       NextGen, Job Juncture, TRILLIUM STAFF, Express Employme, Kelly Services, Labor Works,
       CorTech LLC, Contemporary, Tradesmen Intl, Premier Staffing, First Connect, MVP Staffing,
       Career Group, Adecco, LaborMax Staffin
     * Kept in mapping for historical data (6 inactive): ARC TALENT SOLUT, EMP SERV LLC,
       WWR PLACEMENT, SENTRY LLC, ESSG II (500), 3 PROMISE LABOR

   - Filtering Logic for Staffing-Only View:
     * Uses INNER JOIN with staffing_agencies CTE
     * Pattern match: UPPER(ACH_INSTITUTION_NAME) LIKE '%' || UPPER(agency_name) || '%'
     * Ensures all variations of agency names are captured (e.g., "ADECCO USA INC" and "ADECCO USA, INC.")

BUSINESS LOGIC:
- Direct deposits are identified exclusively by TRANSACTION_CODE = 'PMOF'
- All monetary values are in USD
- Institution names may have trailing spaces (preserved from source data)
- Historical months (Aug, Sep, Oct 2025) maintain original data for comparison
- Dynamic date ranges (Last 30/60/90, Current Month) update with fresh data
- Staffing Agencies Only view uses same date range as Last 90 Days but filters to staffing agencies

DATA REFRESH FREQUENCY:
- This is a static report generated on November 12, 2025
- To refresh with current data, re-run Snowflake queries with updated date ranges
- Queries available in this HTML file's JavaScript dataCache object
- Staffing agency list should be periodically reviewed and updated

KNOWN LIMITATIONS:
- Some institutions may appear with slight name variations
- ACH_INSTITUTION_NAME field may contain trailing spaces
- Company type categorization is based on predefined mapping (may need updates for new institutions)
- Staffing agency identification is based on Nov 12, 2025 research; new agencies may emerge
- Pattern matching for staffing agencies may occasionally include false positives

SAMPLE QUERY TEMPLATE FOR STAFFING AGENCIES ONLY:
WITH staffing_agencies AS (
    SELECT * FROM (VALUES
        ('ATLANTA STAFFING'), ('Drive Staff Inc'), ... [all 32 agencies]
    ) AS t(agency_name)
)
SELECT
    COUNT(DISTINCT trans.PRN) as unique_users,
    COUNT(*) as total_transactions,
    ROUND(SUM(trans.TRANSACTION_AMOUNT), 2) as total_volume,
    ROUND(AVG(trans.TRANSACTION_AMOUNT), 2) as avg_deposit
FROM MYBAMBU_PROD.BAMBU_MART_GALILEO.MART_SRDF_POSTED_TRANSACTIONS trans
INNER JOIN staffing_agencies sa
    ON UPPER(trans.ACH_INSTITUTION_NAME) LIKE '%' || UPPER(sa.agency_name) || '%'
WHERE trans.TRANSACTION_CODE = 'PMOF'
    AND DATE(trans.POST_DATE) BETWEEN 'START_DATE' AND 'END_DATE'

NOTES:
- Date range selector buttons use static date mappings to ensure consistency
- Each preset button maps to specific start/end dates in presetDates object
- Chart instances are destroyed and recreated on data updates to prevent memory leaks
- Staffing-only view replaces company type pie chart with list of top 20 staffing agencies
- Staffing agency list shows both frequency and volume metrics for transparency

========================================
-->
    <div class="container">
        <header>
            <h1>Direct Deposit Analysis</h1>
            <p class="subtitle">ACH Transaction Insights & Trends</p>
        </header>

        <div class="content">
            <div class="date-selector">
                <h2>Select Date Range</h2>
                <div class="preset-buttons">
                    <button class="preset-btn active" onclick="setPreset('last_30')">Last 30 Days</button>
                    <button class="preset-btn" onclick="setPreset('last_60')">Last 60 Days</button>
                    <button class="preset-btn" onclick="setPreset('last_90')">Last 90 Days</button>
                    <button class="preset-btn" onclick="setPreset('last_90_staffing')">Last 90 Days (Staffing Agencies Only)</button>
                    <button class="preset-btn" onclick="setPreset('august_2025')">August 2025</button>
                    <button class="preset-btn" onclick="setPreset('september_2025')">September 2025</button>
                    <button class="preset-btn" onclick="setPreset('october_2025')">October 2025</button>
                    <button class="preset-btn" onclick="setPreset('november_2025')">November 2025</button>
                </div>
            </div>

            <div class="summary-cards">
                <div class="card">
                    <h3>Unique Users</h3>
                    <div class="value" id="uniqueUsers">12,193</div>
                    <p>with Direct Deposits</p>
                </div>
                <div class="card">
                    <h3>Total Transactions</h3>
                    <div class="value" id="totalTransactions">36,300</div>
                    <p>ACH deposits received</p>
                </div>
                <div class="card">
                    <h3>Total Volume</h3>
                    <div class="value" id="totalVolume">$28.2M</div>
                    <p>in direct deposits</p>
                </div>
                <div class="card">
                    <h3>Average Deposit</h3>
                    <div class="value" id="avgDeposit">$777.37</div>
                    <p>per transaction</p>
                </div>
            </div>

            <div class="chart-section" id="companyTypeSection">
                <h2>Users with Direct Deposit by Company Type</h2>
                <div class="chart-container">
                    <canvas id="companyTypeChart"></canvas>
                </div>
            </div>

            <div class="chart-section" id="staffingListSection" style="display: none;">
                <h2>Top 20 Staffing Agencies</h2>
                <div class="staffing-list" id="staffingList"></div>
            </div>

            <div class="chart-section">
                <h2>Direct Deposit Amount Distribution</h2>
                <div class="chart-container">
                    <canvas id="bucketsChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2 id="frequencyChartTitle">Top 10 ACH Institutions by Frequency</h2>
                <div class="chart-container">
                    <canvas id="frequencyChart"></canvas>
                </div>
            </div>

            <div class="chart-section">
                <h2 id="volumeChartTitle">Top 10 ACH Institutions by Volume</h2>
                <div class="chart-container">
                    <canvas id="volumeChart"></canvas>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Data Source:</strong> MYBAMBU_PROD.BAMBU_MART_GALILEO.MART_SRDF_POSTED_TRANSACTIONS</p>
            <p><strong>Last Updated:</strong> November 12, 2025</p>
            <p>Created by: Paid Ads Team</p>
        </footer>
    </div>

    <script>
        let bucketsChartInstance = null;
        let frequencyChartInstance = null;
        let volumeChartInstance = null;
        let companyTypeChartInstance = null;
        let currentPreset = 'last_30';

        // Company type categorization mapping (Updated Nov 12, 2025)
        const companyTypeMapping = {
            'Employers': [
                'DoorDash, Inc.', 'UBER USA 6787', 'Amazon Logistics', 'AMAZON.COM SVCS', 'WAL-MART ASSOCS.',
                'TYSON FOODS, INC', 'COMPASS GROUP', 'CHEDRAUI USA INC', 'FUYAO GLASS AMER', 'LAKESIDE FOODS',
                'UBER USA, LLC', 'RAISER 6795', 'JERDON ENTERPRIS', 'UFP INDUSTRIES I', 'VOSS USA LLC',
                'LIBERTY CASTING', 'BECHTEL GROUP IN', 'DPR Construction', 'BAKER CONCRETE C', 'ASPEN BUILDERS,',
                'MIDLAND CONSTRUC', 'ENVIRONMENTAL DE', 'FOX ENTERPRISES,', 'TRADITIONS MANAG', 'Oakridge Nursery',
                'SUNSHINE DAIRY L', 'TORGINOL INC', 'NEXTGEN HD DRILL', 'SPARTAN COMPANIE', 'KENTUCKY MIRROR',
                'CREATIVE LIQUID', 'LIQUID STRUCTURE', 'ADVANCED WALLS', 'ALFARO S INDUSTR', 'ASCHER BUILDING',
                'RSL CONTRACTORS,', 'EMPIRE AG LLC', 'EXPO SERVICES LL', 'Bloom Lawn and L', 'MCPLASTER POOLS',
                'FOREVER CLEAN PO', 'FLEET EQUIPMENT', 'MIESFELD S TRIAN', 'A R TRIM ENTERPR', 'ABG OPERATING LL',
                'FULL CIRCLE DAIR', 'DELOREAN QUALITY', 'Todd & Sargent,', 'PROFESSIONAL POW', 'GARDNER-WATSON D',
                'Gemini Express T', 'RPM INSTALLATION', 'CHEDRAUI USA INC', 'Ouris Mark 8638', 'LARRETT ENERGY S',
                'Savard Labor & M', '7shifts', 'Miter Payroll', 'TEAM MEMBERS'
            ],
            'Staffing Agencies': [
                // Active agencies (verified Nov 12, 2025)
                'ATLANTA STAFFING', 'Drive Staff Inc', 'LEADERS STAFFING', 'LUXOR STAFFING',
                'Kamps, Inc.-OSV', 'PEOPLEASE', 'Staffing Partner', 'Medix',
                'TEAM EASYSTAFF', 'HIRE Dynamics', 'People 2.0', 'NextGen',
                'Job Juncture', 'TRILLIUM STAFF', 'Express Employme', 'Kelly Services',
                'Labor Works', 'CorTech LLC', 'Contemporary', 'Tradesmen Intl',
                'Premier Staffing', 'First Connect', 'MVP Staffing', 'Career Group',
                'Adecco', 'LaborMax Staffin',
                // Inactive (kept for historical data)
                'ARC TALENT SOLUT', 'EMP SERV LLC', 'WWR PLACEMENT', 'SENTRY, LLC',
                'ESSG II (500)', '3 PROMISE LABOR'
            ],
            'Payroll Companies / Fintech': [
                'DAILYPAY', 'STRIPE', 'Square Inc', 'GUSTO', 'GUSTO PAYROLL', 'ADP TOTALSOURCE',
                'PAYCHEX ADVANCE', 'MM HR PAYROLL', 'MINUTE MEN HR', 'ARA-1', 'BARRETT BUSINESS',
                'TRH WD PAYROLL Q', 'Coadvantage Reso', 'Partners 1784', 'Wisely ACH', 'Payroll4Const',
                'EPAY SYSTEMS', 'PR2416 2111 ENDE', 'CARD SERVICES'
            ],
            'Financial Institutions': [
                'WELLS FARGO IFI', 'JPMorgan Chase', 'BANK OF AMERICA', 'CAPITAL ONE', 'STERLING NAT BNK',
                'AXIOM BANK NA FB', 'FTSB'
            ],
            'Government / Treasury Payments': [
                'SSA  TREAS 310', 'SSI  TREAS 310', 'IRS  TREAS 310'
            ],
            'Money Transfer / Remittance Services': [
                'VIAMERICAS CORP'
            ]
        };

        function categorizeInstitution(name) {
            const cleanName = name.trim();
            for (const [category, institutions] of Object.entries(companyTypeMapping)) {
                if (institutions.some(inst => cleanName.includes(inst.trim()) || inst.trim().includes(cleanName))) {
                    return category;
                }
            }
            return 'Employers'; // Default fallback
        }

        function calculateCompanyTypeBreakdown(topByVolume) {
            const breakdown = {
                'Employers': 0,
                'Staffing Agencies': 0,
                'Payroll Companies / Fintech': 0,
                'Financial Institutions': 0,
                'Government / Treasury Payments': 0,
                'Money Transfer / Remittance Services': 0
            };

            topByVolume.forEach(inst => {
                const category = categorizeInstitution(inst.name);
                breakdown[category] += inst.volume;
            });

            return breakdown;
        }

        // Preset to date range mapping (Static dates to match cached data)
        const presetDates = {
            'last_30': ['2025-10-13', '2025-11-11'],
            'last_60': ['2025-09-13', '2025-11-11'],
            'last_90': ['2025-08-14', '2025-11-11'],
            'last_90_staffing': ['2025-08-14', '2025-11-11'],
            'august_2025': ['2025-08-01', '2025-08-31'],
            'september_2025': ['2025-09-01', '2025-09-30'],
            'october_2025': ['2025-10-01', '2025-10-31'],
            'november_2025': ['2025-11-01', '2025-11-11']
        };

        const dataCache = {"2025-10-13_2025-11-11":{"summary":{"uniqueUsers":12193,"totalTransactions":36300,"totalVolume":28218598.53,"avgDeposit":777.37},"buckets":[{"range":"$1-$250","count":6940},{"range":"$250-$500","count":4865},{"range":"$500-$750","count":8092},{"range":"$750-$1,000","count":6476},{"range":"$1,000-$1,500","count":6427},{"range":"$1,500-$2,500","count":3017},{"range":"$2,500+","count":483}],"topByFrequency":[{"name":"DoorDash, Inc.  ","count":670,"volume":145319.90},{"name":"Amazon Logistics","count":666,"volume":150410.55},{"name":"WELLS FARGO IFI ","count":515,"volume":172737.24},{"name":"UBER USA 6787   ","count":404,"volume":142738.10},{"name":"DAILYPAY        ","count":383,"volume":136767.60},{"name":"JPMorgan Chase  ","count":345,"volume":83980.30},{"name":"VIAMERICAS CORP ","count":168,"volume":49124.28},{"name":"CARD SERVICES   ","count":166,"volume":51904.44},{"name":"ARA-1           ","count":149,"volume":97560.53},{"name":"STRIPE          ","count":139,"volume":19661.83}],"topByVolume":[{"name":"WELLS FARGO IFI ","count":515,"volume":172737.24},{"name":"Amazon Logistics","count":666,"volume":150410.55},{"name":"DoorDash, Inc.  ","count":670,"volume":145319.90},{"name":"UBER USA 6787   ","count":404,"volume":142738.10},{"name":"DAILYPAY        ","count":383,"volume":136767.60},{"name":"TEAM MEMBERS    ","count":104,"volume":111066.14},{"name":"ARA-1           ","count":149,"volume":97560.53},{"name":"JPMorgan Chase  ","count":345,"volume":83980.30},{"name":"SSA  TREAS 310  ","count":78,"volume":81602.00},{"name":"ATLANTA STAFFING","count":81,"volume":78705.73}]},"2025-09-13_2025-11-11":{"summary":{"uniqueUsers":14239,"totalTransactions":71728,"totalVolume":55880629.15,"avgDeposit":779.06},"buckets":[{"range":"$1-$250","count":13747},{"range":"$250-$500","count":9507},{"range":"$500-$750","count":15804},{"range":"$750-$1,000","count":12897},{"range":"$1,000-$1,500","count":12918},{"range":"$1,500-$2,500","count":5898},{"range":"$2,500+","count":957}],"topByFrequency":[{"name":"DoorDash, Inc.  ","count":1327,"volume":277971.35},{"name":"Amazon Logistics","count":1218,"volume":266035.01},{"name":"WELLS FARGO IFI ","count":1087,"volume":370964.68},{"name":"JPMorgan Chase  ","count":761,"volume":184162.39},{"name":"DAILYPAY        ","count":728,"volume":261778.87},{"name":"UBER USA 6787   ","count":700,"volume":233903.03},{"name":"CARD SERVICES   ","count":371,"volume":121583.15},{"name":"VIAMERICAS CORP ","count":329,"volume":88481.68},{"name":"STRIPE          ","count":318,"volume":41724.61},{"name":"ARA-1           ","count":297,"volume":197784.77}],"topByVolume":[{"name":"WELLS FARGO IFI ","count":1087,"volume":370964.68},{"name":"DoorDash, Inc.  ","count":1327,"volume":277971.35},{"name":"Amazon Logistics","count":1218,"volume":266035.01},{"name":"DAILYPAY        ","count":728,"volume":261778.87},{"name":"UBER USA 6787   ","count":700,"volume":233903.03},{"name":"TEAM MEMBERS    ","count":211,"volume":226547.49},{"name":"ARA-1           ","count":297,"volume":197784.77},{"name":"MM HR PAYROLL   ","count":226,"volume":197244.26},{"name":"JPMorgan Chase  ","count":761,"volume":184162.39},{"name":"SSA  TREAS 310  ","count":152,"volume":167671.34}]},"2025-08-14_2025-11-11":{"summary":{"uniqueUsers":16550,"totalTransactions":112763,"totalVolume":87808256.97,"avgDeposit":778.70},"buckets":[{"range":"$1-$250","count":20979},{"range":"$250-$500","count":15066},{"range":"$500-$750","count":25153},{"range":"$750-$1,000","count":20734},{"range":"$1,000-$1,500","count":20243},{"range":"$1,500-$2,500","count":9145},{"range":"$2,500+","count":1443}],"topByFrequency":[{"name":"DoorDash, Inc.  ","count":2030,"volume":425475.25},{"name":"WELLS FARGO IFI ","count":1738,"volume":580843.02},{"name":"Amazon Logistics","count":1671,"volume":360319.77},{"name":"JPMorgan Chase  ","count":1269,"volume":314618.69},{"name":"UBER USA 6787   ","count":1137,"volume":354393.10},{"name":"DAILYPAY        ","count":1126,"volume":416065.83},{"name":"CARD SERVICES   ","count":563,"volume":184789.38},{"name":"STRIPE          ","count":479,"volume":63061.53},{"name":"ARA-1           ","count":478,"volume":309991.12},{"name":"VIAMERICAS CORP ","count":474,"volume":123363.00}],"topByVolume":[{"name":"WELLS FARGO IFI ","count":1738,"volume":580843.02},{"name":"DoorDash, Inc.  ","count":2030,"volume":425475.25},{"name":"DAILYPAY        ","count":1126,"volume":416065.83},{"name":"Amazon Logistics","count":1671,"volume":360319.77},{"name":"UBER USA 6787   ","count":1137,"volume":354393.10},{"name":"TEAM MEMBERS    ","count":317,"volume":342216.83},{"name":"MM HR PAYROLL   ","count":366,"volume":315828.19},{"name":"JPMorgan Chase  ","count":1269,"volume":314618.69},{"name":"ARA-1           ","count":478,"volume":309991.12},{"name":"ADP TOTALSOURCE ","count":239,"volume":260019.63}]},"2025-08-14_2025-11-11_staffing":{"summary":{"uniqueUsers":159,"totalTransactions":1296,"totalVolume":1077024.28,"avgDeposit":831.04},"buckets":[{"range":"$1-$250","count":62},{"range":"$250-$500","count":174},{"range":"$500-$750","count":356},{"range":"$750-$1,000","count":345},{"range":"$1,000-$1,500","count":284},{"range":"$1,500-$2,500","count":67},{"range":"$2,500+","count":8}],"topByFrequency":[{"name":"Kamps, Inc.-OSV ","count":219,"volume":188792.53},{"name":"ATLANTA STAFFING","count":216,"volume":221508.50},{"name":"LUXOR STAFFING  ","count":159,"volume":84835.41},{"name":"Drive Staff Inc ","count":157,"volume":183571.33},{"name":"PEOPLEASE       ","count":155,"volume":98831.32},{"name":"LEADERS STAFFING","count":132,"volume":118387.96},{"name":"Staffing Partner","count":124,"volume":66619.25},{"name":"NEXTGEN HD DRILL","count":91,"volume":93074.00},{"name":"ADECCO USA, INC.","count":23,"volume":10695.70},{"name":"ADECCO USA INC  ","count":20,"volume":10708.28}],"topByVolume":[{"name":"ATLANTA STAFFING","count":216,"volume":221508.50},{"name":"Kamps, Inc.-OSV ","count":219,"volume":188792.53},{"name":"Drive Staff Inc ","count":157,"volume":183571.33},{"name":"LEADERS STAFFING","count":132,"volume":118387.96},{"name":"PEOPLEASE       ","count":155,"volume":98831.32},{"name":"NEXTGEN HD DRILL","count":91,"volume":93074.00},{"name":"LUXOR STAFFING  ","count":159,"volume":84835.41},{"name":"Staffing Partner","count":124,"volume":66619.25},{"name":"ADECCO USA INC  ","count":20,"volume":10708.28},{"name":"ADECCO USA, INC.","count":23,"volume":10695.70}]},"2025-11-01_2025-11-11":{"summary":{"uniqueUsers":8490,"totalTransactions":9725,"totalVolume":7456359.92,"avgDeposit":766.72},"buckets":[{"range":"$1-$250","count":1904},{"range":"$250-$500","count":1374},{"range":"$500-$750","count":2188},{"range":"$750-$1,000","count":1636},{"range":"$1,000-$1,500","count":1687},{"range":"$1,500-$2,500","count":816},{"range":"$2,500+","count":120}],"topByFrequency":[{"name":"Amazon Logistics","count":218,"volume":52220.89},{"name":"DoorDash, Inc.  ","count":154,"volume":34229.46},{"name":"WELLS FARGO IFI ","count":143,"volume":43288.64},{"name":"DAILYPAY        ","count":106,"volume":43425.56},{"name":"UBER USA 6787   ","count":106,"volume":37459.18},{"name":"JPMorgan Chase  ","count":96,"volume":25107.06},{"name":"SSA  TREAS 310  ","count":60,"volume":64054.40},{"name":"VIAMERICAS CORP ","count":49,"volume":14818.28},{"name":"MINUTE MEN HR   ","count":45,"volume":39144.17},{"name":"TRH WD PAYROLL Q","count":44,"volume":24008.08}],"topByVolume":[{"name":"SSA  TREAS 310  ","count":60,"volume":64054.40},{"name":"Amazon Logistics","count":218,"volume":52220.89},{"name":"DAILYPAY        ","count":106,"volume":43425.56},{"name":"WELLS FARGO IFI ","count":143,"volume":43288.64},{"name":"MINUTE MEN HR   ","count":45,"volume":39144.17},{"name":"UBER USA 6787   ","count":106,"volume":37459.18},{"name":"DoorDash, Inc.  ","count":154,"volume":34229.46},{"name":"JPMorgan Chase  ","count":96,"volume":25107.06},{"name":"GUSTO PAYROLL   ","count":20,"volume":24902.03},{"name":"ARA-1           ","count":37,"volume":24503.52}]},"2025-08-01_2025-08-31":{"summary":{"uniqueUsers":12284,"totalTransactions":39954,"totalVolume":31414629.32,"avgDeposit":786.27},"buckets":[{"range":"$1-$250","count":7069},{"range":"$250-$500","count":5183},{"range":"$500-$750","count":9021},{"range":"$750-$1,000","count":7362},{"range":"$1,000-$1,500","count":7485},{"range":"$1,500-$2,500","count":3339},{"range":"$2,500+","count":495}],"topByFrequency":[{"name":"DoorDash, Inc.","count":702,"volume":150318.34},{"name":"WELLS FARGO IFI","count":652,"volume":214974.73},{"name":"JPMorgan Chase","count":477,"volume":120134.11},{"name":"Amazon Logistics","count":477,"volume":92647.27},{"name":"UBER USA 6787","count":458,"volume":122288.27},{"name":"DAILYPAY","count":377,"volume":140194.25},{"name":"CARD SERVICES","count":188,"volume":64967.72},{"name":"Square Inc","count":166,"volume":73308.33},{"name":"ARA-1","count":166,"volume":105931.96},{"name":"VIAMERICAS CORP","count":159,"volume":42402.63}],"topByVolume":[{"name":"WELLS FARGO IFI","count":652,"volume":214974.73},{"name":"DoorDash, Inc.","count":702,"volume":150318.34},{"name":"DAILYPAY","count":377,"volume":140194.25},{"name":"UBER USA 6787","count":458,"volume":122288.27},{"name":"JPMorgan Chase","count":477,"volume":120134.11},{"name":"SSI  TREAS 310","count":143,"volume":119930.31},{"name":"MM HR PAYROLL","count":137,"volume":114986.29},{"name":"GUSTO","count":134,"volume":112977.4},{"name":"TEAM MEMBERS","count":102,"volume":109555.21},{"name":"ARA-1","count":166,"volume":105931.96}]},"2025-09-01_2025-09-30":{"summary":{"uniqueUsers":12298,"totalTransactions":36188,"totalVolume":27504356.4,"avgDeposit":760.04},"buckets":[{"range":"$1-$250","count":7209},{"range":"$250-$500","count":4913},{"range":"$500-$750","count":7963},{"range":"$750-$1,000","count":6616},{"range":"$1,000-$1,500","count":6280},{"range":"$1,500-$2,500","count":2759},{"range":"$2,500+","count":448}],"topByFrequency":[{"name":"DoorDash, Inc.","count":844,"volume":172555.2},{"name":"WELLS FARGO IFI","count":636,"volume":217085.64},{"name":"Amazon Logistics","count":539,"volume":118306.36},{"name":"UBER USA 6787","count":514,"volume":154537.4},{"name":"JPMorgan Chase","count":464,"volume":117678.57},{"name":"DAILYPAY","count":355,"volume":136175.05},{"name":"CARD SERVICES","count":226,"volume":77607.43},{"name":"VIAMERICAS CORP","count":171,"volume":36990.08},{"name":"STRIPE","count":170,"volume":21583.93},{"name":"Square Inc","count":167,"volume":61780.3}],"topByVolume":[{"name":"WELLS FARGO IFI","count":636,"volume":217085.64},{"name":"DoorDash, Inc.","count":844,"volume":172555.2},{"name":"UBER USA 6787","count":514,"volume":154537.4},{"name":"DAILYPAY","count":355,"volume":136175.05},{"name":"MM HR PAYROLL","count":143,"volume":124926.06},{"name":"Amazon Logistics","count":539,"volume":118306.36},{"name":"JPMorgan Chase","count":464,"volume":117678.57},{"name":"TEAM MEMBERS","count":107,"volume":115653.12},{"name":"ADP TOTALSOURCE","count":76,"volume":100857.43},{"name":"ARA-1","count":154,"volume":96363.85}]},"2025-10-01_2025-10-31":{"summary":{"uniqueUsers":12511,"totalTransactions":42949,"totalVolume":33925519.14,"avgDeposit":789.9},"buckets":[{"range":"$1-$250","count":7795},{"range":"$250-$500","count":5610},{"range":"$500-$750","count":9604},{"range":"$750-$1,000","count":7909},{"range":"$1,000-$1,500","count":7853},{"range":"$1,500-$2,500","count":3597},{"range":"$2,500+","count":581}],"topByFrequency":[{"name":"DoorDash, Inc.","count":687,"volume":145676.88},{"name":"Amazon Logistics","count":665,"volume":141879.3},{"name":"WELLS FARGO IFI","count":596,"volume":206387.93},{"name":"DAILYPAY","count":436,"volume":148600.1},{"name":"JPMorgan Chase","count":415,"volume":103627.06},{"name":"UBER USA 6787","count":303,"volume":106591.18},{"name":"CARD SERVICES","count":194,"volume":56402.0},{"name":"STRIPE","count":194,"volume":26120.38},{"name":"ARA-1","count":186,"volume":123019.59},{"name":"VIAMERICAS CORP","count":174,"volume":49952.0}],"topByVolume":[{"name":"WELLS FARGO IFI","count":596,"volume":206387.93},{"name":"TEAM MEMBERS","count":156,"volume":168899.48},{"name":"DAILYPAY","count":436,"volume":148600.1},{"name":"DoorDash, Inc.","count":687,"volume":145676.88},{"name":"Amazon Logistics","count":665,"volume":141879.3},{"name":"SSI  TREAS 310","count":161,"volume":135144.4},{"name":"MM HR PAYROLL","count":152,"volume":132104.71},{"name":"ARA-1","count":186,"volume":123019.59},{"name":"UBER USA 6787","count":303,"volume":106591.18},{"name":"ATLANTA STAFFING","count":102,"volume":106466.3}]}};

        function setPreset(presetName) {
            currentPreset = presetName;
            document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            updateData();
        }

        function updateData() {
            const dates = presetDates[currentPreset];
            let cacheKey = `${dates[0]}_${dates[1]}`;

            // Special handling for staffing agencies view
            if (currentPreset === 'last_90_staffing') {
                cacheKey = '2025-08-14_2025-11-11_staffing';
            }

            let data = dataCache[cacheKey];

            if (!data) {
                const fallbackDates = presetDates.last_30;
                const fallbackKey = `${fallbackDates[0]}_${fallbackDates[1]}`;
                data = dataCache[fallbackKey];
                currentPreset = 'last_30';
                document.querySelectorAll('.preset-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.preset-btn')[0].classList.add('active');
            }

            updateSummaryCards(data.summary);
            updateCharts(data);
        }

        function updateSummaryCards(summary) {
            document.getElementById('uniqueUsers').textContent = formatNumber(summary.uniqueUsers);
            document.getElementById('totalTransactions').textContent = formatNumber(summary.totalTransactions);
            document.getElementById('totalVolume').textContent = formatCurrency(summary.totalVolume);
            document.getElementById('avgDeposit').textContent = formatCurrency(summary.avgDeposit);
        }

        function updateCharts(data) {
            if (bucketsChartInstance) bucketsChartInstance.destroy();
            if (frequencyChartInstance) frequencyChartInstance.destroy();
            if (volumeChartInstance) volumeChartInstance.destroy();
            if (companyTypeChartInstance) companyTypeChartInstance.destroy();

            // Show/hide sections based on view
            const isStaffingView = currentPreset === 'last_90_staffing';
            document.getElementById('companyTypeSection').style.display = isStaffingView ? 'none' : 'block';
            document.getElementById('staffingListSection').style.display = isStaffingView ? 'block' : 'none';

            // Update chart titles
            document.getElementById('frequencyChartTitle').textContent = isStaffingView
                ? 'Top 20 Staffing Agencies by Frequency'
                : 'Top 10 ACH Institutions by Frequency';
            document.getElementById('volumeChartTitle').textContent = isStaffingView
                ? 'Top 20 Staffing Agencies by Volume'
                : 'Top 10 ACH Institutions by Volume';

            if (isStaffingView) {
                // Render staffing agency list
                renderStaffingList(data.topByFrequency);
            } else {
                // Company Type Pie Chart
                const companyBreakdown = calculateCompanyTypeBreakdown(data.topByVolume);
                const companyTypeCtx = document.getElementById('companyTypeChart').getContext('2d');
                companyTypeChartInstance = new Chart(companyTypeCtx, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(companyBreakdown),
                        datasets: [{
                            data: Object.values(companyBreakdown),
                            backgroundColor: [
                                '#22c55e',  // Employers - Green
                                '#fbbf24',  // Staffing Agencies - Yellow
                                '#f97316',  // Payroll/Fintech - Orange
                                '#3b82f6',  // Financial Institutions - Blue
                                '#a855f7',  // Government - Purple
                                '#ec4899'   // Money Transfer - Pink
                            ],
                            borderWidth: 2,
                            borderColor: '#fff'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'right',
                                labels: {
                                    padding: 15,
                                    font: {
                                        size: 12
                                    }
                                }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        const label = context.label || '';
                                        const value = context.parsed || 0;
                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                        const percentage = ((value / total) * 100).toFixed(1);
                                        return `${label}: $${value.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2})} (${percentage}%)`;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            // Buckets Chart
            const bucketsCtx = document.getElementById('bucketsChart').getContext('2d');
            bucketsChartInstance = new Chart(bucketsCtx, {
                type: 'bar',
                data: {
                    labels: data.buckets.map(b => b.range),
                    datasets: [{
                        label: 'Number of Transactions',
                        data: data.buckets.map(b => b.count),
                        backgroundColor: 'rgba(30, 64, 175, 0.8)',
                        borderColor: 'rgba(30, 64, 175, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Frequency Chart
            const frequencyCtx = document.getElementById('frequencyChart').getContext('2d');
            frequencyChartInstance = new Chart(frequencyCtx, {
                type: 'bar',
                data: {
                    labels: data.topByFrequency.map(i => i.name),
                    datasets: [{
                        label: 'Transaction Count',
                        data: data.topByFrequency.map(i => i.count),
                        backgroundColor: 'rgba(29, 78, 216, 0.8)',
                        borderColor: 'rgba(29, 78, 216, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // Volume Chart
            const volumeCtx = document.getElementById('volumeChart').getContext('2d');
            volumeChartInstance = new Chart(volumeCtx, {
                type: 'bar',
                data: {
                    labels: data.topByVolume.map(i => i.name),
                    datasets: [{
                        label: 'Transaction Volume ($)',
                        data: data.topByVolume.map(i => i.volume),
                        backgroundColor: 'rgba(30, 64, 175, 0.8)',
                        borderColor: 'rgba(30, 64, 175, 1)',
                        borderWidth: 2
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return '$' + (value / 1000).toFixed(0) + 'K';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return '$' + context.parsed.x.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
                                }
                            }
                        }
                    }
                }
            });
        }

        function renderStaffingList(agencies) {
            const listContainer = document.getElementById('staffingList');
            listContainer.innerHTML = '';

            agencies.forEach((agency, index) => {
                const item = document.createElement('div');
                item.className = 'staffing-list-item';
                item.innerHTML = `
                    <div>
                        <span style="color: #6c757d; margin-right: 10px;">${index + 1}.</span>
                        <span class="staffing-name">${agency.name.trim()}</span>
                    </div>
                    <div class="staffing-stats">
                        <span><strong>${formatNumber(agency.count)}</strong> transactions</span>
                        <span><strong>${formatCurrency(agency.volume)}</strong> volume</span>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        function formatNumber(num) {
            return num.toLocaleString();
        }

        function formatCurrency(num) {
            if (num >= 1000000) {
                return '$' + (num / 1000000).toFixed(1) + 'M';
            }
            return '$' + num.toLocaleString(undefined, {minimumFractionDigits: 2, maximumFractionDigits: 2});
        }

        window.onload = function() {
            updateData();
        };
    </script>
</body>
</html>